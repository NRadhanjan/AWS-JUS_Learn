<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Computer Networks - JusLearn</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body { margin:0; font-family:'Poppins',sans-serif; background:#121212; color:#e0e0e0; }
  header { background:#1e1e1e; color:#00e5ff; padding:15px 30px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 3px 10px rgba(0,255,255,0.2); }
  header h1{margin:0; font-size:24px;}
  nav a { color:#00e5ff; margin-left:20px; text-decoration:none; font-weight:500; transition:color 0.3s; }
  nav a:hover { color:#ff4081; }
  .banner { background:linear-gradient(135deg, #00e5ff, #ff4081); padding:50px 20px; text-align:center; color:#121212; border-radius:0 0 30px 30px; box-shadow:0 5px 15px rgba(0,255,255,0.3);}
  .banner h2 { font-size:36px; margin:0; }
  .banner p { margin-top:10px; font-size:18px; }
  .modules-container { width:100%; display:flex; flex-direction:column; align-items:center; margin-top:40px; }
  .accordion { background:#1c1c1c; cursor:pointer; padding:18px; width:90%; max-width:900px; margin:20px 0; border:none; text-align:left; font-size:18px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.5); color:#00e5ff; transition:all 0.3s ease; position: relative; }
  .accordion:hover { background:#222222; }
  .accordion .checkmark { position: absolute; right: 20px; font-size: 20px; color: #76ff03; display: none; }
  .panel { display:none; background:#1c1c1c; border-radius:0 0 10px 10px; width:90%; max-width:900px; margin:0 auto 20px auto; padding:15px; box-shadow:inset 0 2px 6px rgba(0,255,255,0.1);}
  .topic { background:#2a2a2a; padding:12px 15px; margin:10px 0; border-radius:6px; cursor:pointer; transition:all 0.3s ease; border-left:4px solid #00e5ff; position: relative; }
  .topic:hover { background:#333333; border-left-color:#ff4081; box-shadow:0 0 8px #00e5ff; }
  .topic .checkmark { position: absolute; right: 15px; font-size: 18px; color: #76ff03; display: none; }
  .content-area { width:90%; max-width:900px; margin:50px auto 50px auto; padding:20px; background:#1c1c1c; border-radius:12px; box-shadow:0 6px 12px rgba(0,255,255,0.2);}
  iframe { width:100%; height:400px; border-radius:10px; margin-bottom:15px; }
  .btn { display:inline-block; padding:10px 20px; background:#00e5ff; color:#121212; text-decoration:none; border-radius:6px; transition:all 0.3s; }
  .btn:hover { background:#ff4081; color:#fff; box-shadow:0 0 12px #ff4081; }
  form input[type="file"] { margin:10px 0; }
  form button { background:#76ff03; color:#121212; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; transition:all 0.3s; }
  form button:hover { background:#b6ff00; box-shadow:0 0 10px #76ff03; }
</style>
</head>
<body>

<header>
  <h1>JusLearn</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="login.html">Login</a>
  </nav>
</header>

<div class="banner">
  <h2>Computer Networks</h2>
  <p>Understand protocols, layers, and data communication</p>
</div>

<div class="modules-container">
  <button class="accordion">Module 1: Networking Basics <span class="checkmark">âœ”</span></button>
  <div class="panel">
    <div class="topic" data-id="11">Topic 1: OSI Model <span class="checkmark">âœ”</span></div>
    <div class="topic" data-id="12">Topic 2: TCP/IP Model <span class="checkmark">âœ”</span></div>
  </div>

  <button class="accordion">Module 2: Data Communication <span class="checkmark">âœ”</span></button>
  <div class="panel">
    <div class="topic" data-id="13">Topic 1: IP Addressing <span class="checkmark">âœ”</span></div>
    <div class="topic" data-id="14">Topic 2: Routing <span class="checkmark">âœ”</span></div>
  </div>
</div>

<div id="contentArea" class="content-area">
  <h2>Select a topic to view content</h2>
</div>

<script>
  // Accordion toggle
  let acc = document.getElementsByClassName("accordion");
  for (let i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
      this.classList.toggle("active");
      let panel = this.nextElementSibling;
      panel.style.display = (panel.style.display === "block") ? "none" : "block";
    });
  }

  const API_BASE_URL = "http://13.60.50.127:5000";

  // Upload function
  async function uploadAssignment(event, topicId) {
    event.preventDefault();
    const userId = localStorage.getItem('userId');
    const statusElement = document.getElementById(`uploadStatus-${topicId}`);
    statusElement.innerText = "Uploading...";

    if (!userId) {
      statusElement.innerText = "Error: Please log in to upload an assignment.";
      return;
    }

    const formData = new FormData(event.target);
    try {
      const res = await fetch(`${API_BASE_URL}/api/upload/${userId}/${topicId}`, {
        method: 'POST',
        body: formData,
      });
      const data = await res.json();
      statusElement.innerText = res.ok ? `âœ… Uploaded! ${data.message}` : `âŒ Upload failed: ${data.message || res.statusText}`;
      if (res.ok) updateUI();
    } catch (error) {
      statusElement.innerText = "âŒ Network error.";
      console.error('Upload Error:', error);
    }
  }

  // Show topic content
  function showContent(title, videoUrl, pdfUrl, topicId) {
    const contentArea = document.getElementById("contentArea");
    contentArea.innerHTML = `
      <h2>${title}</h2>
      <h3>ðŸ“º Video</h3>
      <iframe src="${videoUrl}" title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen></iframe>
      <h3>ðŸ“‘ Resource</h3>
      <a href="${pdfUrl}" target="_blank" class="btn">Download Notes</a>
      <h3>ðŸ“‚ Assignment</h3>
      <form onsubmit="uploadAssignment(event, '${topicId}')">
        <input type="file" name="assignment" required>
        <button type="submit">Upload</button>
      </form>
      <p id="uploadStatus-${topicId}"></p>
    `;
    contentArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // Progress updater
  async function updateUI() {
    const userId = localStorage.getItem('userId');
    if (!userId) return;

    try {
      const res = await fetch(`${API_BASE_URL}/api/progress/${userId}`);
      const progressData = await res.json();
      const completedTopics = new Map(progressData
        .filter(topic => topic.completed === 1)
        .map(topic => [topic.topicId.toString(), true]));

      document.querySelectorAll(".topic").forEach(topic => {
        let id = topic.getAttribute("data-id");
        let check = topic.querySelector(".checkmark");
        check.style.display = completedTopics.has(id) ? "inline" : "none";
      });

      document.querySelectorAll(".accordion").forEach(acc => {
        let topics = acc.nextElementSibling.querySelectorAll(".topic");
        let allDone = Array.from(topics).every(t => completedTopics.has(t.getAttribute("data-id")));
        acc.querySelector(".checkmark").style.display = allDone ? "inline" : "none";
      });
    } catch (error) {
      console.error("Could not load user progress:", error);
    }
  }

  // Topic mapping
  document.querySelectorAll(".topic").forEach(topic => {
    topic.addEventListener("click", () => {
      let title = topic.innerText.replace("âœ”", "").trim();
      let topicId = topic.getAttribute("data-id");
      let pdfUrl = "sample.pdf";
      let videoUrl = "";

      // âœ… Updated with your new YouTube embeds
      if (topicId === "11") {videoUrl = "https://www.youtube.com/embed/vv4y_uOneC0?si=GGrxahBBWoZm7ITp";pdfUrl="osi.pdf";}
      if (topicId === "12") {videoUrl = "https://www.youtube.com/embed/2QGgEk20RXM?si=AkSQRQTk6HKKP8Lo";pdfUrl="tcpip.pdf";}
      if (topicId === "13") {videoUrl = "https://www.youtube.com/embed/zZ02fvBXNAI?si=e1WBJLhepr-vv7CH";pdfUrl="ipaddr.pdf";}
      if (topicId === "14") {videoUrl = "https://www.youtube.com/embed/8Yr0S_TphEo?si=STwStqEnGnV2ug6R";pdfUrl="routing.pdf";}

      showContent(title, videoUrl, pdfUrl, topicId);
    });
  });

  updateUI();
</script>
</body>
</html>
